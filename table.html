<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="blog about software writing and using">
  <meta name="keywords" content="Go">
  <meta name="author" content="prr">
  <meta name="date" content="1\3\2021">
  <meta  name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azul Software</title><style>
* {
  margin: 0;
  padding: 0;
  font-family: Calibri;
  list-style: none;
  text-decoration:none;
  font-size: 20pt;
}

#main {
	width: calc(100% - 300px);
	border: 1px solid blue;
	min-height: 300px;
}
#header {
	height: 100px;
	margin: 10px;
	border: 1px solid DeepPink;
}
#doc {
	min-height: 500px;
	margin: 10px;
	border: 1px solid Tomato;
}

#footer {
	height: 100px;
	margin: 10px;
	border: 1px solid green;
}
.doctitle {
	color: SlateBlue;
	padding: 1em;
	margin: 1em;
}

#tsttab {
	margin: 1em;
	margin-left: 3em;
	border-spacing: 0px;
	border-collapse: collapse;
}
#tab2 {
	margin: 1em;
	margin-left: 3em;
	position: relative;
	top: 10px;
	border-spacing: 0px;
	border-collapse: collapse;
}
th, td {
	border: 1px solid black;
	padding: 10px;
	width: 150px;
}
.tblCol1 {
	width:50px;
}
.tblCol1:hover {
	background-color: Violet;
}

#but {
	position: relative;
	top: 10px;
	margin-left: 3em;
	width: 200px;
	background-color: pink;
}

#but:hover {
	cursor: pointer;
	background-color: purple;
	color: white;
}
</style>
</head>
<body>
 <div id="main">
   <section id="header">
   </section>
   <section id="doc">
		<h3 class="doctitle">This is the end of something great</h3>
		<table id="tsttab">
  			<tr>
				<th class="tblCol1">id</th>
    			<th>Firstname</th>
    			<th>Lastname</th>
  			</tr>
  			<tr>
				<td class="tblCol1">1</td>
    			<td contenteditable='true'>Jill</td>
    			<td contenteditable='true'>Smith</td>
  			</tr>
  			<tr>
				<td class="tblCol1">2</td>
				<td contenteditable='true'>Eve</td>
				<td contenteditable='true'>Jackson</td>
  			</tr>
		</table>
	<button id="but">Click Me!</button>

	<h3 class="doctitle">Second Table generated by js</h3>
   </section>
   <section id="footer">
   </section>
 </div>
 <script>

	var tabobj = {lcol: -1, lrow: -1 , maxcol: -1, maxrow: -1};

	tabobj.init_dtable = function() {
		let dat_tab = [
 			[{val: 'John', nval: 'John'}, {val: 'Crow', nval: 'Crow'}],
 			[{val: 'Jim',nval: 'Jim'},{val: 'Beam', nval:'Beam'}],
			[{val: 'Peter', nval: 'Peter'}, {val: 'Rabbit', nval: 'Rabbit'}]
		];
	return dat_tab;
	}

	tabobj.gen_table = function(dataArr) {

		num_rows = dataArr.length
		tabobj.maxrow = num_rows
		if (num_rows < 1) {
			console.log('error dataArr insufficient rows')
			return;
		}
		num_cols = dataArr[0].length
		tabobj.maxcol = num_cols
		if (num_cols < 1) {
			console.log('error dataArr insufficient cols')
			return;
		}

//		console.log('rows: ' + num_rows + ' cols: ' + num_cols)

		let el = document.getElementById("doc");
		let table = document.createElement('table');
		table.id = "tab2";

		let theader = table.createTHead();
		let hrow = theader.insertRow();
		let hcell = hrow.insertCell();
		hcell.textContent = 'id';
		hcell = hrow.insertCell();
		hcell.textContent = 'First';
		hcell = hrow.insertCell();
		hcell.textContent = 'Name';
			
		let tbody = table.createTBody();	
		let irow = 0;
		for (let row of dataArr) {
			let trow = tbody.insertRow();
			let newCell = trow.insertCell();
			newCell.textContent = irow;
			irow++;
			for (let cell of row) {
				let newCell = trow.insertCell();
				newCell.textContent = cell.val;
				newCell.contentEditable = 'true';
			}
		}
		el.appendChild(table);
	}

	tabobj.telfunc = function(e) {
		let cel = e.target
		let icol = cel.cellIndex
		let irow = cel.parentNode.rowIndex 
//		console.log('input' + cel + ' icol: ' + icol + ' irow: ' + irow );
	}

	tabobj.telfunc2 = function(e) {
		let cel = e.target;
		let icol = cel.cellIndex;
		let irow = cel.parentNode.rowIndex; 
//		console.log('click' + cel + ' icol: ' + icol + ' irow: ' + irow );
	}

	tabobj.focout = function(e) {
		let cel = e.target;
		let icol = cel.cellIndex;
		let irow = cel.parentNode.rowIndex;
		tabobj.dtab[irow-1][icol-1].nval = cel.textContent;
//		console.log('blur: ' + cel.textContent + ' |icol: ' + icol + ' irow: ' + irow );
	}

	tabobj.keyd = function(e) {
		let key = e.key;
		let cel = e.target;
		let ctrlkey = e.ctrlKey;
		let icol = cel.cellIndex;
		let irow = cel.parentNode.rowIndex;
//		console.log('key down1: ' + key + ' control: ' + ctrlkey + ' row: ' + irow + ' col: ' + icol);

		switch (key) {
    	case "ArrowLeft":
        	if (ctrlkey) {				
				if (icol>1) tabobj.tab.rows[irow].cells[icol-1].focus();
			}
        break;
    	case "ArrowRight":
        // Right pressed
        	if (ctrlkey) {
				if (icol < tabobj.maxcol) tabobj.tab.rows[irow].cells[icol+1].focus();
			}

        	break;
    	case "ArrowUp":
        // Up pressed
        	if (ctrlkey) {
				if (irow > 1) tabobj.tab.rows[irow-1].cells[icol].focus();
			}

        	break;
    	case "ArrowDown":
        // Down pressed
        	if (ctrlkey) {
				if (irow < tabobj.maxrow) tabobj.tab.rows[irow+1].cells[icol].focus();
			}

        	break;
		default:
			return;
		}
//		console.log('key down2: ' + key + ' control: ' + ctrlkey );
	}


	tabobj.keyup = function(e) {
		let key = e.key;
	}



	tabobj.butfunc = function(){
		let focus_el = tab2.rows[1].cells[1];
		focus_el.focus();
//		console.log('button click');
	}

	

	window.onload = function(){
		tabobj.dtab = tabobj.init_dtable();
		tabobj.gen_table(tabobj.dtab);

		tabobj.tab = document.getElementById("tab2")
		tab2 = tabobj.tab
//		console.log('lcol: ' + tab2.lcol + ' lrow: ' + tab2.lrow); 		
//		console.log(' rows: ' + tabobj.tab.rows.length); 		
		let jrow = tab2.rows[0];
//		console.log(' cols: ' + jrow.cells.length);
		tab2.addEventListener('input',tabobj.telfunc);
		tab2.addEventListener('click',tabobj.telfunc2);
//		tab2.addEventListener('focusout',tabobj.focout);

		tab2.addEventListener('keydown',tabobj.keyd);
//		tab2.addEventListener('keydown',tabobj.keyd, {once: true});

		tab2.addEventListener('keyup',tabobj.keyup);
		but.addEventListener('click',tabobj.butfunc);
//		console.log('lcol: ' + tabobj.lcol + ' lrow: ' + tabobj.lrow); 		
	}

 </script>
</body>
</html>
